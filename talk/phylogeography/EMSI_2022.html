<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Phylogeography</title>
    <meta charset="utf-8" />
    <meta name="author" content="Alexander A. Fisher" />
    <script src="EMSI_2022_files/header-attrs-2.11/header-attrs.js"></script>
    <link href="EMSI_2022_files/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="EMSI_2022_files/panelset-0.2.6/panelset.js"></script>
    <script src="EMSI_2022_files/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <link href="EMSI_2022_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="EMSI_2022_files/datatables-binding-0.22/datatables.js"></script>
    <script src="EMSI_2022_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <link href="EMSI_2022_files/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="EMSI_2022_files/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="EMSI_2022_files/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
    <link href="EMSI_2022_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="EMSI_2022_files/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="slide-theme-zero.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Phylogeography
## A tutorial introduction with the West Nile virus
### Alexander A. Fisher
### Department of Statistical Science<br/>Duke University
### NC State University EMSI, 18 May 2022

---














## Follow along

- Slides hosted at [athos00.github.io](https://athos00.github.io)
- Ensure you have [java jdk](https://www.oracle.com/java/technologies/downloads/) installed
- Click to download [files for this tutorial](https://drive.google.com/drive/folders/1KmryhyvvnY5FrNe_kSpKZodXYre1GXFx?usp=sharing), these include
  - BEAST `jar` file
  - West Nile virus `xml`
  
--

## Scope

We'll go through the methods described in &lt;a name=cite-dellicour2020epidemiological&gt;&lt;/a&gt;[Dellicour, et al. (2020)](#bib-dellicour2020epidemiological)

Note, if you'd like to recreate the exact analyses of the paper, find reproducible files here: [github.com/sdellicour/wnv_north_america](https://github.com/sdellicour/wnv_north_america)

---

## West Nile virus (WNV)

&lt;img src="img/WNV-dellicour2020.png" width="1350" style="display: block; margin: auto;" /&gt;

&lt;div style="margin-bottom:-20px;"&gt;
&lt;/div&gt;
.center[
[Dellicour, et al. (2020)](#bib-dellicour2020epidemiological)
]

---


# Goals

--

1. Reconstruct the dispersal history of WNV on the continent

--

2. Compare the dispersal dynamics of different WNV genotypes (while controlling for possibly confounding environmental covariates)

--

3. Test the impact of environmental factors on the dispersal locations, dispersal velocity and history of WNV lineages

--

To investigate either of the last two, we must combine geography, evolutionary history and environmental covariates in a sensible statistical framework


---

# This talk

- The relaxed random walk

- Wrangling the data

- Hypothesis testing

---

class: inverse, center, middle

# Relaxed random walk&lt;br/&gt;(RRW)

---

# First, the random walk

&lt;img src="img/treeDiffusion.png" width="1350" style="display: block; margin: auto;" /&gt;

---

# Random walk: theory

.pull-left[
&lt;img src="img/tree_strictBD.png" width="675" style="display: block; margin: auto auto auto 0;" /&gt;
]

.pull-right[
.left[
**The Model**
]
- `\(\mathbf{Y}_i \sim \text{MVN}(\mathbf{Y}_{\text{pa}(i)}, t_i \Sigma)\)`

.left[
**Notation**
]
- trait vector `\(\mathbf{Y}_i = \{\text{lat, long}\}\)`
- branch time `\(t_i\)`
- common covariance `\(\Sigma\)` describes step-size
]

---

# Relaxed random walk: theory

.pull-left[
&lt;img src="img/tree_RRW.png" width="675" style="display: block; margin: auto auto auto 0;" /&gt;

.center[&lt;a name=cite-lemey2010&gt;&lt;/a&gt;[Lemey, et al. (2010)](#bib-lemey2010)]

]
.pull-right[
.left[
**The Model**
]
- `\(\mathbf{Y}_i \sim \text{MVN}(\mathbf{Y}_{\text{pa}(i)},  \boxed{\phi_i} t_i \Sigma)\)`
.left[
**Notation**
]
- trait vector `\(\mathbf{Y}_i = \{\text{lat, long}\}\)`
- branch time `\(t_i\)`
- `\(\Sigma\)` describes fixed (relative) covariance structure
- branch-rate `\(\phi_i\)`
]
---

# Relaxed random walk: practice

## Your turn

--

Fit the RRW

- 104 West Nile virus isolates and their (approximate) geographic location of sampling&lt;br/&gt; &lt;a name=cite-pybus2012unifying&gt;&lt;/a&gt;[Pybus, et al. (2012)](#bib-pybus2012unifying)

- fixed topology (for tutorial purposes)

---

# Relaxed random walk: practice

1. Open terminal (mac) or command prompt (windows)

--

2. Navigate to `wnv-tutorial` file

--

3. `$ java -jar beast.jar -overwrite wnv.xml`


--

## Your own analysis

- To create your own XML for your own analyses, follow tutorial [here](https://beast.community/workshop_continuous_diffusion_wnv#introduction)

---

# Faster inference

#### A note on building your own XML in the future

- The `wnv.xml` contains *fast* inference machinery to learn about branch-specific rates `\((\boldsymbol{\phi})\)`

- If you create your own XML (using the tutorial linked on the previous page), your results will be slower.

- Practically, replacing the `scaleOperator` on `branchRatesDiffusion.rates` with `&lt;HamiltonianMonteCarloOperator&gt;` lets us obtain results in seconds rather than hours

- See &lt;a name=cite-fisher2021relaxed&gt;&lt;/a&gt;[Fisher, et al. (2021)](#bib-fisher2021relaxed) for a description of the faster implementation and [the associated GitHub repo](https://github.com/suchard-group/RRW_at_scale) for more example XML
--

#### TL;DR

- If your analysis is slow, there are methods to dramatically improve the speed but currently no GUI. Feel free to reach out to me if you need help troubleshooting.

---

class: inverse, center, middle

# Wrangling the data

---

# Extracting information from `.tree` files

.panelset[
.panel[.panel-name[Extracted data frame]
<div id="htmlwidget-772f02a74a89cf2f3b77" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-772f02a74a89cf2f3b77">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[[200,106,199,107,1,108,109,2,110,193,111,181,156,112,116,113,114,115,4,3,5,6,154,117,7,118,119,124,121,120,8,9,123,122,11,10,13,12,125,14,126,44,128,127,16,15,136,129,17,130,24,131,132,134,133,20,19,18,135,23,21,22,145,137,144,138,25,139,141,140,27,26,143,142,29,28,31,30,33,32,146,153,147,34,35,148,149,41,150,151,36,37,38,152,39,40,43,42,155,47,46,45,157,160,158,51,48,159,50,49,162,161,53,52,163,54,164,73,55,165,169,166,56,167,57,168,59,58,170,172,171,62,61,60,178,173,63,174,175,68,176,177,65,64,67,66,72,179,69,180,70,71,184,182,76,183,75,74,185,77,187,186,79,78,188,189,81,80,86,190,191,82,192,85,83,84,87,194,195,88,93,196,197,92,89,198,90,91,94,95,201,205,202,100,99,203,204,96,97,98,206,101,207,104,103,102],[-73.84,-73.81,-74.05,-73.83,-74.07,-73.61,-73.58,-73.48,-74.13,-73.35,-100.79,-73.98,-101.05,-100.48,-100.49,-87.6,-86.67,-87.93,-79.52,-87.82,-73.66,-87.91,-92.8,-98.85,-82.31,-105.72,-100.63,-106.96,-101.06,-99.95,-100.04,-100.12,-99.9,-100.6,-100.31,-100.33,-102.05,-96.12,-106.49,-105.39,-107.35,-100.25,-107.44,-106.81,-106.46,-106.88,-111.68,-114.55,-98.64,-115.55,-114.8,-114.97,-115.05,-115.14,-114.63,-115.03,-114.7,-115.18,-114.92,-114.85,-111.68,-114.95,-111.78,-111.96,-108.28,-112.23,-110.92,-112.13,-114.03,-112.63,-118.2,-106.74,-114.33,-114.24,-106.56,-118.52,-112.17,-112,-108.54,-108.32,-111.52,-111.81,-112.1,-109.46,-112.05,-112.17,-112.34,-100.09,-111.97,-106.85,-112.57,-111.21,-110.02,-106.32,-106.53,-106.5,-111.98,-112.14,-83.22,-95.26,-83.09,-83.25,-106.36,-101.28,-106.85,-103.21,-111.55,-105.73,-117.83,-102.75,-101.52,-95.2,-95.29,-95.1,-101.72,-100.69,-118.17,-105.45,-114.9,-118.23,-118.28,-116.87,-114.92,-116.36,-114.88,-117.95,-117.17,-122.46,-117.88,-118.39,-117.87,-121.49,-118.19,-117.9,-117.06,-118.41,-118.44,-118.41,-118.26,-117.95,-118.4,-117.85,-117.73,-117.91,-118.08,-118.15,-117.02,-117.8,-117.67,-117.95,-118.08,-117.15,-73.66,-73.68,-86.44,-73.21,-82.28,-73.94,-73.59,-73.48,-74.82,-72.74,-72.52,-73.79,-108.82,-75.26,-108.29,-108.49,-84.63,-75.21,-92.04,-75.8,-90.96,-92.11,-95.48,-95.31,-76.24,-81.51,-82.32,-80.68,-82.67,-81.35,-81.69,-91.96,-80.04,-81.64,-82,-82.19,-75.94,-73.99,-74.05,-73.83,-74.4,-73.76,-94.11,-74.74,-73.39,-76.78,-75.88,-73.98,-73.79,-74.06,-73.73,-72.56,-73.79,-74.19],[40.57,40.88,40.79,40.95,40.95,40.9,41,40.88,41.11,41.5,35.45,41.42,35.81,35.08,35.08,42.75,42.62,43.02,42.23,42.08,44.85,43.04,28.24,35.18,28.13,33.73,30.85,34.12,31.08,30.99,31.42,30.98,34.1,30.87,30.94,30.96,35.08,41.26,34.23,39.23,34.61,44.22,34.74,35.27,35.1,35.03,33.3,29.83,24.93,30.06,30.53,30.11,30.11,30.16,30.3,30.1,30.35,30.05,30.35,30.09,29.35,30.22,33.15,33.48,38.94,33.3,32.24,33.37,34,33.27,33.95,32.28,34.18,34.1,31.82,34.24,34.32,33.57,39.02,39.01,32.92,34.21,33.21,35.61,33.29,33.24,33.45,31,33.37,31.26,33.38,32.31,31.75,31.8,31.84,31.78,33.96,33.95,32.58,29.52,32.51,32.49,36.67,35.78,36.55,44.07,39.5,36.46,33.81,34.65,35.44,29.65,29.86,29.65,35.16,34.45,33.96,38.8,30.55,34.03,34.18,32.93,33.12,32.45,32.7,33.25,32.73,37.78,34.16,34.33,34.07,38.58,33.91,34.15,33.89,34.34,34.22,34.09,34.27,33.94,34.34,33.89,33.95,34.1,33.84,33.85,34.04,34.38,34.06,34.31,34.48,34.14,40.69,41.32,39.77,41.34,28.19,42.55,40.7,40.7,42.94,40.62,40.75,40.74,39.43,42.85,39.18,39.09,43.74,42.89,29.98,42.8,29.3,30.04,29.78,29.77,43.46,26.56,26.83,27.64,40.19,27.08,27.16,30.14,26.69,27.1,28.7,27.99,42.84,40.77,40.56,40.62,40.57,40.61,30.07,40.5,40.98,39.43,42.19,41.13,40.72,40.56,40.68,40.94,41.13,41.38],[1998.71,1998.69,1998.72,1998.74,2000.5,1998.74,1999.17,2001.71,1999.74,1999.41,2000.1,1999.84,2000.12,2000.25,2000.28,2000.65,2000.83,2000.8,2003.5,2003.5,2002.5,2003.7,2000.93,2000.36,2003.73,2000.56,2000.71,2000.74,2000.86,2002.32,2002.5,2002.5,2001.38,2002.09,2003.5,2005.5,2003.6,2006.64,2000.97,2003.5,2001.33,2005.5,2001.48,2004.13,2004.57,2004.58,2002.24,2002.62,2003.5,2003.04,2003.5,2003.06,2003.2,2003.14,2003.49,2003.5,2003.5,2003.5,2003.3,2003.5,2003.5,2003.5,2002.36,2002.46,2002.61,2002.54,2006.67,2002.6,2002.81,2002.74,2005.76,2005.67,2002.88,2002.94,2005.59,2007.63,2004.5,2004.57,2004.57,2004.57,2002.54,2002.95,2002.62,2003.5,2004.5,2002.65,2002.77,2005.5,2003.17,2002.83,2003.5,2005.69,2003.5,2004.3,2007.48,2006.66,2005.5,2004.5,2002.11,2003.5,2002.5,2002.5,2002.56,2001.01,2002.69,2004.52,2003.5,2002.86,2003.53,2003.62,2001.6,2003.47,2003.5,2003.5,2001.81,2002.5,2002.42,2003.5,2004.5,2002.47,2002.53,2002.51,2003.5,2002.83,2003.5,2003.66,2004.54,2004.5,2002.68,2002.76,2002.79,2003.5,2003.5,2003.5,2002.79,2002.76,2004.56,2002.84,2004.46,2004.58,2005.06,2005.31,2005.57,2007.59,2005.65,2005.58,2004.49,2002.84,2004.54,2002.88,2003.5,2004.66,2000.46,1999.87,2002.5,1999.93,2003.65,2003.5,2000.54,2002.5,2000.87,2001.02,2003.5,2002.5,2002.82,2000.94,2004.57,2004.53,2002.5,2000.95,2001.04,2002.5,2001.61,2004.5,2003.5,2004.5,2000.5,2000.55,2000.67,2003.5,2002.5,2000.85,2000.9,2002.5,2001.5,2000.95,2002.5,2003.56,1999.66,1999.5,1998.74,1998.75,1999.19,1999.71,2002.62,2000.31,2000.94,2000.5,2002.5,2003.5,1998.75,1999.5,1999.56,2001.5,2003.5,2000.5]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>node<\/th>\n      <th>long<\/th>\n      <th>lat<\/th>\n      <th>date<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[0,1,2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
]
.panel[.panel-name[Code]
```
library(seraphim)
e_WNV = extent(-128, -63, 19, 55) # extent of study area
localTreesDirectory = "treeExtractions" # new folder to create
nberOfExtractionFiles = 10; mostRecentSamplingDatum = 2007.63

allTrees = scan(file="WNV.trees", what="", sep="\n", quiet=T)
burnIn = 0
randomSampling = FALSE
nberOfTreesToSample = 10
coordinateAttributeName = "location"
nberOfCores = 1

treeExtractions(localTreesDirectory,allTrees, burnIn,
randomSampling, nberOfTreesToSample, mostRecentSamplingDatum,
coordinateAttributeName, nberOfCores)
```

- Code snippet from [https://github.com/sdellicour/wnv_north_america](https://github.com/sdellicour/wnv_north_america)

- See &lt;a name=cite-dellicour2016seraphim&gt;&lt;/a&gt;[Dellicour, et al. (2016)](#bib-dellicour2016seraphim) for further reading on the [SERAPHIM](https://github.com/sdellicour/seraphim) package
]
]

---


# We want this data frame:



<div id="htmlwidget-f4c488a550b9af297e63" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f4c488a550b9af297e63">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207],[26.63,44.97,29.86,34.42,43,30.53,31.48,39.68,36.61,38.28,32.3,44.45,36.68,51.05,33.82,29.73,51.39,40.79,44.37,43.44,36.72,41.44,44.97,33.47,33.47,25.67,37.17,31.36,41.45,29.83,45.41,27.01,30.38,35.5,28.24,50.68,21.67,31.22,47.96,46.83,40.77,39.42,36.46,36.65,51.14,36.28,47.31,42.58,42.76,34.5,33.79,40.01,24.06,52.26,47.45,22.34,32.35,41.92,30.9,49.04,27.72,33.93,50.68,51.88,30.71,33.62,35.41,24.23,43.28,45.6,39.88,31.51,46.35,39.51,43.91,50.86,22.43,47.15,32.75,52.04,50.27,38.55,47.7,34.84,45.56,30.71,35.28,33.59,46.51,33.97,23.03,47.11,38.61,51.44,34.5,50.72,38.65,40.72,25.38,25.47,30.7,29.52,42.02,41.99,52.9,35.63,24.18,29.01,45.28,22.42,51.39,25.98,51.47,24.3,44.03,36.53,40.21,21.4,35.6,45.79,51.07,31.89,22.46,25.86,35.07,41.95,50.96,49.59,23.28,44.3,38.31,44.01,45.2,50.46,29.82,29.6,49.58,36.44,29.9,25.99,22.05,42.67,36.99,26.19,52.98,36.36,50.3,52.44,52.55,27.89,22.18,43.45,51.02,52.5,28.59,33.21,23.06,46.12,23.29,24.66,42.63,26.04,34.25,27.82,33.66,35.01,47.44,27.17,46.57,47.87,48.2,23.48,29.05,38.99,30.39,52.12,27.54,29.38,24.72,49.97,22.81,44.66,50.19,36.7,47.6,28.04,25.71,50.87,47.75,42.13,49.71,38.01,35.13,32.39,49.63,38.32,49.04,28.75,25.07,32.33,41.48,29.3,49.25,35.06,38.49,42.14,26.19],[103.1,96.23,121.88,111.63,112.02,85.09,111.35,99.61,101.12,98.95,107.78,72.24,76.13,98.74,92.78,100.1,94.23,88.62,79.06,68.6,69.16,82.71,76.52,75.81,74.83,116.44,115.05,78.96,98.82,93.39,107.37,107.22,110.68,81.87,101.45,78.01,104.7,93.61,79.53,107.66,107.68,112.86,124.84,113.82,83.46,74.68,81.18,99.03,93.32,100.43,93.76,75.32,66.39,99.62,86.28,124.88,90.03,119.47,103.56,76.25,123.14,78.02,108.24,118.91,117.67,107.91,91.96,101.37,119.63,73.87,122.24,111.5,78.46,100.82,120.66,74.15,110.69,121.97,124.62,122.46,76.03,113.26,99.25,66.74,124.63,110.87,113.97,67.08,119.38,113.84,114.76,108.69,79.22,75.99,85.22,78.85,74.96,122.37,91.45,96.12,81.49,81.78,94.2,107.2,106.15,83.57,74.76,106.6,101,112.49,116,104.49,71.1,92.08,120.18,90.2,107.05,113.75,97.04,107.11,109.29,74.5,110.89,86.96,108.29,71.91,115.19,96.14,114.94,111.65,110.47,123.3,80.06,98.79,80.92,101.83,74.78,67.18,118.52,87.82,121.93,105.9,85.68,79.13,103.91,75.1,71.1,114.47,102.67,92.54,116.73,109.67,114.47,94.16,124.66,105.4,76.38,66.24,90.2,117.86,120.94,102.49,73.52,75.76,109.68,111.18,92.38,98.68,101.02,124.05,74.42,92.27,82.25,124.82,85.25,85.01,69.81,73.72,111.64,100.19,85.66,112.99,119.89,92.28,65.98,102.69,79.92,121.67,96.17,90.99,93.73,101.31,66.33,103.08,107.57,97.22,123.2,106.88,112.52,109.84,111.64,111.8,78.27,76.86,119.52,122.74,97.26],[2004.43,1999.1,1999.54,2001.81,2010.66,2007.93,2013.97,2006.31,2011.52,2005.27,2012.09,2008.19,2014.38,2007.69,2007.88,2011.67,2005.92,2002.86,2001.62,2013.71,2001.11,2013.85,2009.86,2015.01,2000.97,2002.15,2013.52,2006.17,2013.29,2000.85,2007.22,2004.64,2007.51,2002.35,2006.8,2015.28,2009.08,2015.95,2005.2,2005.54,2000.85,2011.06,2003.09,2007.25,2002.88,2010.56,2003.9,2013.33,2009.81,2002.32,2001.92,2001.03,2014.13,2008.12,2008.62,2009.26,2011.49,2011.75,2008.6,2008.61,2013.24,2013.83,2008.87,2014.31,2005.16,2010.56,2010.1,2003.76,2005.18,2013.87,2013.76,2001.38,2010.98,2000.91,2002.71,2002.4,2000.67,2010.49,2011.84,2003.06,2009.23,2001.68,2013.71,2012,2001.43,2010.41,2011.73,2004.42,2002.03,1999.08,2013.19,2011.11,2006.29,2004.29,2004.95,2014.36,2001.63,2004.7,1999.66,2011.51,2013.32,2009.33,2011.59,2008.39,2008.04,2001.22,2002.39,2012.42,2004.41,2013.29,2012.39,2000.56,2003.02,2015.7,2001.21,2003.23,2005.97,2014.62,2007.55,2008.84,2003.27,2011.77,2009.04,2013.29,2006.38,2003.27,2008.08,2013.32,2004.02,2001.18,2003.14,2013.6,2006.07,1999.39,1999.41,2008.04,2006.82,2003.1,2006.46,2006.52,1999.88,2011.87,2011.9,2008.99,2015.57,2001.39,2003.43,2008.55,2007.04,2012.63,2007.07,2009.62,2009.09,2014.78,2005.88,2013.41,2004.99,2002.54,2015.28,1999.38,2006.65,2011.83,2011.66,2012.02,2004.56,1999.82,2015.48,2010.41,1999.84,2014.66,2012.7,2011.95,2007.16,2010.49,2008.04,2014.54,2007.33,2003.4,2002.34,2003.8,2005.09,2008.97,2010.42,2002.33,2011.95,2004.59,2015.42,2007.7,2000.59,2012.94,2013.51,2007.84,2008.35,2005.62,2015.83,2006.56,2009.48,2013.07,2008.65,2008.79,2002.12,2013.54,2013.17,2007.86,2014.31,2004.51,2004.95],[9.05,7.95,3.44,3.04,-4.11,6.4,15.01,-1.37,7.95,-5.88,0.38,12.01,12.88,18.6,2.31,1.42,2.93,4.98,28.38,5.15,-4.44,8.17,7.77,9.73,12.11,0.83,-1.13,17.91,13.59,-2.05,17.36,9.31,6.02,12.97,-2.52,13.29,0.84,1.34,12.46,2.9,4.91,2.93,17.29,-1.9,8.13,-4.38,0.53,4.59,1.89,3.85,15,-0.21,7.47,6.64,0.31,1.18,6.04,3,-2.12,7.18,15.78,15.61,10.04,6.93,0.63,-0.07,13.1,8.22,1.5,16.35,10.73,11.72,2.6,7.31,3.68,5.47,16.1,5.63,-5.1,8.77,-2.48,3.3,-3.6,3.33,5.1,5.98,11.42,9.82,16.51,15.14,10.64,6.73,11.78,5.28,-1.96,7.26,3.12,9.53,8.59,10.56,6.25,-5.42,9.73,8.07,-2.49,12.93,8.97,6.33,-1.64,7.91,2.36,1.19,10.79,7.31,-3.48,11.04,-3.35,14.26,9.78,1.72,0.59,1.74,12.82,11.52,13.42,2,10.6,5.25,4.39,11.35,10.1,1.38,7.19,7.74,2.11,3.92,6.49,8.38,14.62,12.42,11.6,8.97,-2.52,0.52,16,16.22,-2.31,5.45,12.55,4.36,7.39,4.41,10.19,7.71,4.32,-0.74,12.41,7.23,-1.82,-4.75,4.27,9.33,-1.98,10.39,0.62,8.56,12.91,15.07,12.16,3.36,11.26,18.25,9.02,9.87,9.76,16.47,7.35,2.57,5.21,7.17,5.24,12.03,10.83,10.31,19.13,6.77,16.52,2.08,-0.61,14.93,3.78,8.45,-3.7,12.94,14.8,9.54,7.47,19.05,5.55,2.72,10.31,-0.12,5.54,6.15,6.78,4.97,6.98],[0.96,0.86,1.82,1.1,0.84,1.52,1.06,2,0.79,0.51,0.6,0.52,0.67,0.73,0.3,1.3,0.36,2.29,1.73,0.55,0.85,0.97,1.99,1.23,1.03,0.97,0.74,1.01,0.67,0.75,0.91,0.3,0.64,1.79,3.62,0.75,1.4,1.21,1.54,1.2,0.48,1.14,1.29,1.04,1.65,0.69,0.65,1.3,0.8,0.85,0.76,1.34,0.69,1.84,1.55,0.56,0.8,3.49,0.85,1.27,0.3,1.51,0.71,1.17,1.05,0.52,0.48,1.13,1.13,1.17,0.72,0.46,0.8,1.67,1.66,1.06,1.08,0.5,1.02,1.03,0.63,1.19,0.81,0.88,1.88,0.74,0.84,0.87,0.38,0.54,0.83,0.92,1.84,0.39,1.75,1.55,1.94,0.69,0.97,0.7,1.47,1.47,0.93,1.03,0.73,0.74,0.97,0.38,1.69,1.77,0.88,0.75,1.2,0.86,0.53,0.69,0.6,1.23,1.15,1.5,1.53,0.7,1.69,1.4,2,0.94,0.95,1.05,1.2,1.01,1.19,0.77,0.85,0.65,0.86,0.94,0.9,0.38,1.07,1.27,1.14,1.91,0.94,2.12,0.64,0.75,0.3,1.11,0.95,0.95,0.48,1.91,0.66,0.6,0.76,0.69,0.76,0.68,0.77,0.47,0.97,0.35,0.85,0.98,1.68,1.32,1.48,0.79,0.79,0.58,0.71,0.88,0.5,0.65,0.47,0.56,1.01,1.41,0.42,0.56,0.68,1.02,0.67,1.05,1.03,1.57,1.09,0.81,1.24,0.74,0.61,0.92,1.27,1.37,1.78,0.74,0.79,1.36,0.79,0.52,0.64,0.72,0.6,0.99,1.35,0.77,0.44]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>node<\/th>\n      <th>long<\/th>\n      <th>lat<\/th>\n      <th>date<\/th>\n      <th>tempC<\/th>\n      <th>annualPrecipitationMeters<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"columnDefs":[{"className":"dt-right","targets":[0,1,2,3,4,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
---
&lt;img src="img/environmental.png" width="850" style="display: block; margin: auto;" /&gt;
---

class: inverse, center, middle

# Are dispersal locations associated with specific environmental conditions?

---
&lt;img src="img/environmental.png" width="850" style="display: block; margin: auto;" /&gt;

---

# Hypothesis test procedure
.pull-left[
1. Test statistic `\(E\)`: mean environmental factor (across all node positions) for a fixed tree

2. We have a distribution of test statistics (100 total, 1 for each tree)

3. We need to generate a distribution of test statistics under the null to compare
]

--

.pull-right[
&lt;img src="img/tree_RRW.png" width="675" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---

# Hypothesis test procedure
.pull-left[
1. Test statistic `\(E\)`: mean environmental factor (across all node positions) for a fixed tree

2. We have a distribution of test statistics (100 total, 1 for each tree)

3. We need to generate a distribution of test statistics under the null to compare

4. To do this, simulate under the RRW

5. Compare `\(E_\text{simulated}\)` to `\(E_\text{estimated}\)`

6. Compute Bayes factor support: `\(\frac{p_e}{1 - p_e}\)` &lt;a name=cite-suchard2005models&gt;&lt;/a&gt;[Suchard, et al. (2005)](#bib-suchard2005models)
]
.pull-right[
&lt;img src="img/tree_RRW.png" width="675" style="display: block; margin: auto 0 auto auto;" /&gt;
]

---
# Environmental conditions by lineage

&lt;img src="img/environmental-condition-by-lineage.png" width="1350" style="display: block; margin: auto;" /&gt;

---

# Acknowledgements

Special thanks to coauthors&lt;br/&gt;Dellicour, S., Lequime, S., Vrancken, B., Gill, M. S., Bastide, P., Gangavarapu, K., Matteson, N., Tan, Y., Du Plessis, L., Fisher, A. A., Nelson, M. I., Gilbert, M., Suchard, M. A., Andersen, K. G., Grubaugh, N. D., Pybus, O. G., and Lemey, P. Epidemiological hypothesis testing using a phylogeographic and phylodynamic framework. Nature Communications, 2020.


--

### Thank you!

---
# References

&lt;a name=bib-dellicour2020epidemiological&gt;&lt;/a&gt;[Dellicour, S. et
al.](#cite-dellicour2020epidemiological) (2020). "Epidemiological
hypothesis testing using a phylogeographic and phylodynamic framework".
In: _Nature communications_ 11.1, pp. 1-11.

&lt;a name=bib-dellicour2016seraphim&gt;&lt;/a&gt;[Dellicour, S. et
al.](#cite-dellicour2016seraphim) (2016). "SERAPHIM: studying
environmental rasters and phylogenetically informed movements". In:
_Bioinformatics_ 32.20, pp. 3204-3206.

&lt;a name=bib-fisher2021relaxed&gt;&lt;/a&gt;[Fisher, A. A. et
al.](#cite-fisher2021relaxed) (2021). "Relaxed random walks at scale".
In: _Systematic Biology_ 70.2, pp. 258-267.

&lt;a name=bib-lemey2010&gt;&lt;/a&gt;[Lemey, P. et al.](#cite-lemey2010) (2010).
"Phylogeography takes a relaxed random walk in continuous space and
time". In: _Molecular Biology and Evolution_ 27.8, pp. 1877-1885.

&lt;a name=bib-pybus2012unifying&gt;&lt;/a&gt;[Pybus, O. G. et
al.](#cite-pybus2012unifying) (2012). "Unifying the spatial
epidemiology and molecular evolution of emerging epidemics". In:
_Proceedings of the National Academy of Sciences_ 109.37, pp.
15066-15071.

&lt;a name=bib-suchard2005models&gt;&lt;/a&gt;[Suchard, M. A. et
al.](#cite-suchard2005models) (2005). "Models for estimating Bayes
factors with applications to phylogeny and tests of monophyly". In:
_Biometrics_ 61.3, pp. 665-673.

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
